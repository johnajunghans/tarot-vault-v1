*This document contains specifications for the MVP and an ordered list of stages for building the MVP. When updating this document, use strikethrough (~~complete~~) to indicate completion of a step or entire plan topic.*
# 0_Specifications
*Project information, useful links, and change log*
## 0.1_Tech Stack
### 0.1.1_initial package.json file
```json
{
	"name": "tarot-vault-v1",
	"version": "0.1.0",
	"private": true,
	"scripts": {
		"dev": "npm-run-all --parallel dev:frontend dev:backend",
		"dev:frontend": "next dev",
		"dev:backend": "convex dev",
		"predev": "convex dev --until-success && convex dashboard",
		"build": "next build",
		"start": "next start",
		"lint": "eslint ."
	},
	"dependencies": {
		"@base-ui/react": "^1.1.0",
		"@clerk/clerk-react": "^5.60.0",
		"@clerk/nextjs": "^6.37.1",
		"class-variance-authority": "^0.7.1",
		"clsx": "^2.1.1",
		"convex": "^1.31.7",
		"hugeicons-react": "^0.4.0",
		"next": "^16.1.6",
		"react": "^19.2.4",
		"react-dom": "^19.2.4",
		"tailwind-merge": "^3.4.0"
	},
	"devDependencies": {
		"@convex-dev/eslint-plugin": "^1.1.1",
		"@tailwindcss/postcss": "^4.1.18",
		"@types/node": "^24.10.9",
		"@types/react": "^19.2.10",
		"@types/react-dom": "^19.2.3",
		"eslint": "^9.39.2",
		"eslint-config-next": "^16.1.6",
		"npm-run-all2": "^8.0.4",
		"prettier": "^3.8.1",
		"tailwindcss": "^4.1.18",
		"tw-animate-css": "^1.4.0",
		"typescript": "^5.9.3"
	}
}
```
### 0.1.2_Core
- React + NextJS
- TypeScript
### 0.1.3_Frontend
### 0.1.4_Backend
#### 0.1.4.1_Database
- Convex
#### 0.1.4.2_Authentication
- Clerk
#### 0.1.4.3_Server
- Vercel
## 0.2_Details
### 0.2.1_Frontend
#### 0.2.1.1_Shadcn
##### 0.2.1.1.1_initial components.json file

```json
{
	"$schema": "https://ui.shadcn.com/schema.json",
	"style": "base-nova",
	"rsc": true,
	"tsx": true,
	"tailwind": {
		"config": "",
		"css": "app/globals.css",
		"baseColor": "stone",
		"cssVariables": true,
		"prefix": ""
	},
	"iconLibrary": "hugeicons",
	"rtl": false,
	"aliases": {
		"components": "@/components",
		"utils": "@/lib/utils",
		"ui": "@/components/ui",
		"lib": "@/lib",
		"hooks": "@/hooks"
	},
	"registries": {}
}
```
##### 0.2.1.1.2_expected components
- Avatar
- Badge
- Breadcrumb
- Button
- Button Group
- Calendar
- Card
- Collapsable
- Date Picker
- Dialog
- Dropdown Menu
- Empty
- Field
- Input
- Label
- Popover
- Progress
- Radio Group
- Resizable
- Scroll Area
- Select
- Separator
- Sidebar
- Skeleton
- Sonner
- Spinner
- Switch
- Tabs
- Toggle
- Toggle Group
- Tooltip
#### 0.2.1.2_Forms
- react-hook-form + zod
	- Use in combination with shadcn/ui Field component to build forms
#### 0.2.1.3_Dark Mode
- next-themes
	- As outlined in shadcn/ui for use with nextjs
### 0.2.2_Backend
#### 0.2.2.1_Convex
##### 0.2.2.1.1_Tables
###### 0.2.2.1.1.1_users
**Properties**
- _id: users._id
- _creationTime: number (auto-generated by Convex, milliseconds since epoch)
- authId: string (id generated by Clerk)
- tokenIdentifier: string 
- updatedAt: number (milliseconds since epoch)
- lastSignedIn: number (milliseconds since epoch)
- name: string
- email: string
- settings: object
	- appearance: object
		- theme: "light" | "dark" | "system" (default = "system")
	- preferences: object
		- useReverseMeanings: "auto" | "always" | "never" (default = "auto")
	- notifications: object
		- private: object
			- showToasts: boolean (default = true) *whether to show toasts on crud operations*

**Indexes**
- by_authId: ["authId"]
###### 0.2.2.1.1.2_readings
**Custom Card Type**
- Card: object
	- id: number (integer between 0 and 77)
	- position?: number (integer between 1 and 78)
	- reversed: boolean
	- notes: string

**Properties**
- _id: readings._id
- _creationTime: number (auto-generated by Convex, milliseconds since epoch)
- userId: users._id
- updatedAt: number (milliseconds since epoch)
- question: string
- date: number (milliseconds since epoch)
- drawMethod: “manual” | “digital”
- digitalDrawRandomness?: “pseudo” | “real” (user just needs a deck of playing cards and a 6 sided die to generate truly random values for card draws)
- spread: object
    - id: spreads._id
    - version: number (between 0 and 77)
- useReverseMeanings: boolean
- useSignifierCard: boolean
- results: object
    - signifier?: Card
    - cards: Card Array
- title?: string
- context?: string
- image?: _storage._id
- parent?: object
    - type: “reading”
    - id: readings._id
- notes?: string
- interpretations?: interpretations._id Array
- starred: boolean (default = false)

**Indexes**
- by_userId_and_updatedAt: ["userId", "updatedAt"]
- by_userId_and_starred: ["userId", "starred"]

###### 0.2.2.1.1.3_interpretations
**Properties**
- _id: interpretations._id
- _creationTime: number (auto-generated by Convex, milliseconds since epoch)
- userId: users._id
- readingId: readings._id (foreign key - one to many: readings can have many interpretations)
- updatedAt: number (milliseconds since epoch)
- content: string
- source: “self” | “ai”
- focus?: string
- aiMetadata: object
    - tier: “free” | “premium”
    - model: object
        - name: string
        - version: string
    - requestTime: number (milliseconds since epoch)
    - totalCost: number
    - tokensUsed: number
    - systemPrompt?: string

**Indexes**
- by_readingId: ["readingId"]
- by_userId_and_source: ["userId", "source"]

###### 0.2.2.1.1.4_spreads
**Properties**
- _id: spreads._id
- _creationTime: number (auto-generated by Convex, milliseconds since epoch)
- userId: users._id
- updatedAt: number (milliseconds since epoch)
- name: string
- description?: string
- numberOfCards: number (integer between 1 and 78)
- positions: objectArray
    - name: string
    - description?: string
    - transform: object
        - x: number
        - y: number
        - r: number
        - z: number

**Indexes**
- by_userId_and_updatedAt: ["userId", "updatedAt"]

## 0.3_Resources
- [Convex: NextJS+Convex Quickstart](https://docs.convex.dev/quickstart/nextjs)
- [Convex: NextJS+Convex Docs](https://docs.convex.dev/client/nextjs/app-router/)
- [Convex: NextJS+Convex+Clerk Setup](https://docs.convex.dev/auth/clerk#nextjs)
- [Clerk: Convex+Clerk Setup](https://clerk.com/docs/guides/development/integrations/databases/convex)
- [Shadcn: next-themes darkmode setup](https://ui.shadcn.com/docs/dark-mode/next)
- [Convex: storing users in the convex database](https://docs.convex.dev/auth/database-auth)
## 0.4_Git
*Protocol for git version control*
### 0.4.1_Repo Info
- url: https://github.com/johnajunghans/tarot-vault-v1
- license: none
- readme: none
## 0.5_Change Log
*This is a space to track all updates.*
### 0.5.1_Example Entry

**02/02/2026 (date) -- 0.5.1 (step) -- Claude 4.5 Sonnet (model)**
Summary of actions taken (be as concise as possible):
- Action 1
- Action 2
	- Sub-action 1
	- Sub-action 2
- Action 3

Future considerations/recommendations/warnings (Anything at all to consider about this topic moving forward)
- Future consideration/recommendation/warning 1
- Future consideration/recommendation/warning 2
- Future consideration/recommendation/warning 3
### 0.5.2_Entries
*Ordered with most recent at the top*

### 0.5.3_Archived Entries
- 1.3.9 — Local Storage Draft Saving
- 1.3.8 — Final Polishing 1
- Refactor — AppTopbar props instead of Zustand store
- 1.3.7 — Save functionality (validation, Convex create, toasts)
- 1.3.6 — Card Overview (sortable tiles, drag-to-reorder, edit/delete)
- 1.3.5 — Group card select and group drag (marquee + multi-drag)
- 1.3.4 — Card details panel (third resizable panel, position/name/description/allowReverse/x/y/rotation/zIndex)
- 1.3.3 — Spread canvas and card (GSAP drag, grid, alignment guides, spacebar pan)
- 1.3.2 — New Spread page (form with name, numberOfCards, description; topbar integration)
- 1.3.1 — Topbar Zustand store and dynamic title/buttons
- 02/05 — Landing page redesign, global palette, sidebar/topbar refinement
- 1.2.3 — App topbar (sidebar toggle, breadcrumbs, New dropdown)
- 1.2.2 — App sidebar (header link, Interpretations, Settings, collapsed-state fixes)
- 1.2.1 — Setup (layout title, landing auth/redirect, shadcn components)
- 1.1.5 — Convex Vitest test infrastructure and 64 tests (users, readings, spreads, interpretations, http)
- 1.1.4 — Code review (returns validators, index-based queries, DRY validators, _id standardization)
- 1.1.3 — readings.ts, interpretations.ts, spreads.ts CRUD
- 1.1.2 — Clerk webhook, users.ts (current, upsertFromClerk, deleteFromClerk)
- 1.1.1 — Convex schema (users, readings, interpretations, spreads; indexes)

# 1_Build Plan
## ~~1.1_Database & Auth Setup~~
*Full steps archived in mvp-build-archive.md.*
- **1.1.1** — Create database tables in /convex/schema.ts; create indexes; update 0.2.2.1.1 with index specs. ~~Complete~~
- **1.1.2** — Create webhook to sync Clerk with users table: /convex/users.ts, /convex/http.ts; follow [Convex guide](https://docs.convex.dev/auth/database-auth#set-up-webhooks); scan project for auth improvements.
- **1.1.3** — Create readings.ts, interpretations.ts, spreads.ts with list/create/update/remove + table-specific queries. ~~Complete~~
- **1.1.4** — Code review of 1.1.1–1.1.3. ~~Complete~~
- **1.1.5** — Convex tests per table ([Convex Tests](https://docs.convex.dev/testing/convex-test)). ~~Complete~~

## ~~1.2_Frontend Setup~~
*Create placeholder landing page and main components shared by all routes on app. Full steps archived in mvp-build-archive.md.*
- **1.2.1** — Setup: update layout title; landing page (auth, redirect to /app, /app → /app/personal); install shadcn components from 0.2.1.1.2. ~~Complete~~
- **1.2.2** — App-sidebar: header links to /app; content (Personal, Readings, Spreads, Interpretations, tooltips/collapsed fix); footer (UserButton, Settings). ~~Complete~~
- **1.2.3** — App-topbar: sidebar toggle, breadcrumbs (no "app", ChevronRight), placeholder center title, New dropdown (Reading, Spread, Interpretation). ~~Complete~~

## ~~1.3_New Spread~~
*Full steps archived in mvp-build-archive.md.*
- **1.3.1** — Topbar: Zustand store (/stores/topbar.ts) for title (name, addInfo, draft) and rightButtonGroup; app-topbar title section + conditional buttons. ~~Complete~~
- **1.3.2** — New Spread page: two-column layout; left panel form (name, numberOfCards, description) with react-hook-form + zod; topbar integration (Save/Discard, draft badge, live title). ~~Complete~~
- **1.3.3** — Spread canvas (1500×1500 SVG, grid, spacebar pan) and card (GSAP drag, snap-to-grid, alignment guides). ~~Complete~~
- **1.3.4** — Card details panel: third resizable panel; Position/Name/Description/Allow Reverse/X-Y/Rotation/Z-Index; link spread type to schema. ~~Complete~~
- **1.3.5** — Group card select: marquee selection + group drag. ~~Complete~~
- **1.3.6** — Card overview: sortable tiles in spread settings (GSAP drag-to-reorder), edit/delete, "New Card" button. ~~Complete~~
- **1.3.7** — Save: Convex create mutation, disabled+spinner, toasts (Sonner). ~~Complete~~
- **1.3.8** — Final polishing: remove card hover-delete (use panel "Remove Card"), auto-select new card, group-deselect on card click, validation toasts + expand panel, responsive canvas, tooltips. ~~Complete~~
- **1.3.9** — Local storage draft saving: persist form to localStorage; discard confirmation (Cancel / Save as draft / Discard). *In progress / see archive for full spec.*

## 1.4_View/Edit Spreads
### 1.4.1_Spreads Page
1. Create a component in /app/personal/spreads to that renders a shadcn card component showing a given spread. Eventually, clicking on the spread will open up the page to view or edit the given spread.
	1. The component should accept a prop for whether the spread is a draft or not, in which case it should have a badge indicating that it is a draft.
	2. The component should display the name of the spread along with the date (just MM/DD/YYYY).
2. The spreads page (/app/personal/spreads/page.tsx) should use the `list` query in the spreads table functions to read the 10 most recently created spreads. These should be displayed using the above card component.
3. The spreads page should also read local storage and pull all items with a key matching the pattern `spread-draft-${Date.now()}`. The date.now() value in the key can be parsed to give the date of the spread draft. 
	1. If the draft has no name, then "Untitled Spread" can be used.
	2. These spread drafts should be rendered in a separate section from the spreads taken from the db.